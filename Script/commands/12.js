const schedule = require('node-schedule');
const axios = require('axios');
const moment = require('moment-timezone');
const fs = require('fs');

module.exports.config = {
  name: 'autosent',
  version: '8.0.0',
  hasPermssion: 0,
  credits: 'Ã‚ÃŸhrÃ¥fÃ¹l ÃŽÃŸlÄm',
  description: '12-Hour Luxury Box Update with Precise Weather',
  commandCategory: 'system',
  usages: '[]',
  cooldowns: 3
};

// ðŸ’Ž à§§à§¨ à¦˜à¦£à§à¦Ÿà¦¾à¦° à¦œà¦¨à§à¦¯ à§§à§¨à¦Ÿà¦¿ à¦®à¦œà¦¾à¦¦à¦¾à¦° à¦“ à¦¸à§à¦¨à§à¦¦à¦° à¦•à§à¦¯à¦¾à¦ªà¦¶à¦¨
const quotes = [
  "à§§ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦¦à§à¦ªà§à¦°à§‡à¦° à¦°à§‹à¦¦à§‡ à¦œà§€à¦¬à¦¨à¦Ÿà¦¾ à¦¯à§‡à¦¨ à¦ªà§à§œà§‡ à¦¤à¦¨à§à¦¦à§à¦°à¦¿ à¦šà¦¿à¦•à§‡à¦¨ à¦¹à§Ÿà§‡ à¦¯à¦¾à¦šà§à¦›à§‡! ðŸ—",
  "à§¨ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦­à¦¾à¦¤ à¦–à§‡à§Ÿà§‡ à¦˜à§à¦® à¦¦à§‡à¦“à§Ÿà¦¾ à¦¹à¦²à§‹ à¦à¦‡ à¦¦à§à¦¨à¦¿à§Ÿà¦¾à¦° à¦¶à§à¦°à§‡à¦·à§à¦  à¦¬à¦¿à¦²à¦¾à¦¸à¦¿à¦¤à¦¾à¥¤ ðŸ˜´",
  "à§© à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦à¦‡ à¦¸à¦®à§Ÿà§‡ à¦œà§€à¦¬à¦¨ à¦¨à¦¿à§Ÿà§‡ à¦­à¦¾à¦¬à¦²à§‡ à¦¶à§à¦§à§ à¦¹à¦¤à¦¾à¦¶à¦¾ à¦†à¦° à¦–à¦¿à¦¦à§‡ à¦›à¦¾à§œà¦¾ à¦•à¦¿à¦›à§à¦‡ à¦†à¦¸à§‡ à¦¨à¦¾à¥¤ ðŸŸ",
  "à§ª à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦šà¦¾ à¦–à¦¾à¦“à§Ÿà¦¾à¦° à¦¸à¦®à§Ÿ à¦¹à§Ÿà§‡à¦›à§‡, à¦†à¦¡à§à¦¡à¦¾à¦¬à¦¾à¦œà¦°à¦¾ à¦¸à¦¬ à¦•à¦‡? â˜•",
  "à§« à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦¬à¦¿à¦•à§‡à¦²à§‡à¦° à¦¬à¦¾à¦¤à¦¾à¦¸ à¦¬à¦²à¦›à§‡â€” à¦¬à¦¾à¦¬à§ à¦à¦•à¦Ÿà¦¾ à¦«à§à¦šà¦•à¦¾ à¦–à§‡à§Ÿà§‡ à¦à¦¸à§‹! ðŸ¥™",
  "à§¬ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦¸à§‚à¦°à§à¦¯ à¦¡à§à¦¬à¦›à§‡, à¦†à¦° à¦†à¦®à¦¾à¦° à¦®à¦¤à§‹ à¦¸à¦¿à¦™à§à¦—à§‡à¦²à¦°à¦¾ à¦¶à§à¦§à§ à¦¦à§€à¦°à§à¦˜à¦¶à§à¦¬à¦¾à¦¸ à¦›à¦¾à§œà¦›à§‡! ðŸŒ‡",
  "à§­ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦¸à¦¨à§à¦§à§à¦¯à¦¾ à¦®à¦¾à¦¨à§‡à¦‡ à¦¬à¦¾à¦¸à¦¾à§Ÿ à¦«à§‡à¦°à¦¾à¦° à¦¤à¦¾à§œà¦¾, à¦†à¦° à¦ªà§œà¦¾à¦° à¦Ÿà§‡à¦¬à¦¿à¦²à§‡à¦° à¦¸à¦¾à¦¥à§‡ à¦¯à§à¦¦à§à¦§à¥¤ ðŸ“–",
  "à§® à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦«à§‹à¦¨ à¦Ÿà¦¿à¦ªà¦¤à§‡ à¦Ÿà¦¿à¦ªà¦¤à§‡ à¦†à¦™à§à¦² à¦¬à§à¦¯à¦¥à¦¾, à¦¤à¦¾à¦“ à¦¶à¦¾à¦¨à§à¦¤à¦¿ à¦¨à§‡à¦‡! ðŸ“±",
  "à§¯ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦°à¦¾à¦¤à§‡à¦° à¦–à¦¾à¦¬à¦¾à¦° à¦°à§‡à¦¡à¦¿? à¦¨à¦¾à¦•à¦¿ à¦†à¦œà¦“ à¦¨à¦¾ à¦–à§‡à§Ÿà§‡à¦‡ à¦¸à§à¦¬à¦ªà§à¦¨ à¦¦à§‡à¦–à¦¬à§‹? ðŸ±",
  "à§§à§¦ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦•à¦®à§à¦¬à¦² à¦®à§à§œà¦¿ à¦¦à¦¿à§Ÿà§‡ à¦­à¦¾à¦¬à¦›à¦¿â€” à¦•à¦¾à¦² à¦¥à§‡à¦•à§‡ à¦¸à¦¤à§à¦¯à¦¿ à¦¸à¦¤à§à¦¯à¦¿ à¦•à¦¾à¦œ à¦¶à§à¦°à§ à¦•à¦°à¦¬à§‹! ðŸ›Œ",
  "à§§à§§ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦®à¦§à§à¦¯à¦°à¦¾à¦¤à§‡à¦° à¦®à¦¾à§Ÿà¦¾ à¦¬à§œà¦‡ à¦…à¦¦à§à¦­à§à¦¤, à¦˜à§à¦® à¦†à¦¸à§‡ à¦¨à¦¾ à¦¶à§à¦§à§ à¦¸à§à¦®à§ƒà¦¤à¦¿ à¦†à¦¸à§‡à¥¤ ðŸŽžï¸",
  "à§§à§¨ à¦Ÿà¦¾ à¦¬à¦¾à¦œà§‡: à¦¶à§à¦­ à¦°à¦¾à¦¤à§à¦°à¦¿! à¦à¦‡ à¦¸à¦®à§Ÿà§‡ à¦¯à¦¾à¦°à¦¾ à¦œà§‡à¦—à§‡ à¦†à¦›à§‡ à¦¤à¦¾à¦°à¦¾ à¦¸à¦¬à¦¾à¦‡ à¦¹à§Ÿ à¦•à¦¬à¦¿, à¦¨à§Ÿà¦¤à§‹ à¦›à§à¦¯à¦¾à¦à¦•à¦¾ à¦–à¦¾à¦“à§Ÿà¦¾ à¦ªà§à¦°à§‡à¦®à§€! ðŸŒ™"
];

const indexFile = './autosentIndex.json';
function loadIndex() {
  if (fs.existsSync(indexFile)) return JSON.parse(fs.readFileSync(indexFile, 'utf8'));
  return { iQuote: 0 };
}
function saveIndex(iQuote) {
  fs.writeFileSync(indexFile, JSON.stringify({ iQuote }));
}

let { iQuote: indexQuote } = loadIndex();

module.exports.onLoad = ({ api }) => {
  const rule = new schedule.RecurrenceRule();
  rule.tz = 'Asia/Dhaka';
  rule.minute = 0; 

  schedule.scheduleJob(rule, async () => {
    try {
      const now = moment().tz('Asia/Dhaka');
      const time = now.format('hh:mm A');
      const date = now.format('DD/MM/YYYY');
      const hour = now.hour();

      // à§§à§¨ à¦˜à¦£à§à¦Ÿà¦¾à¦° à¦‡à¦¨à¦¡à§‡à¦•à§à¦¸ à¦ à¦¿à¦• à¦•à¦°à¦¾ (à§¦-à§§à§§)
      const currentQuoteIndex = hour % 12;

      // à§¨. à¦•à§à§œà¦¿à¦—à§à¦°à¦¾à¦® à¦“ à¦°à§Œà¦®à¦¾à¦°à§€ à¦†à¦¬à¦¹à¦¾à¦“à§Ÿà¦¾ (Humidity à¦¸à¦¹)
      let weatherInfo = "Update Unavailable â˜ï¸";
      try {
        const res = await axios.get(`https://api.openweathermap.org/data/2.5/weather?q=Kurigram&units=metric&appid=e38b33e1d689b0284980484b9071060b`);
        const temp = Math.round(res.data.main.temp);
        const humidity = res.data.main.humidity; 
        const desc = res.data.weather[0].description;
        weatherInfo = `${temp}Â°C â€¢ Humidity: ${humidity}% â€¢ ${desc}`;
      } catch (e) { weatherInfo = "Connection Error âš ï¸"; }

      const quote = quotes[currentQuoteIndex];

      const msg = `
â•­â”€â”€â”€â”€â”€ â”â”â”â”â”â” â”€â”€â”€â”€â”€â•®
     ðŸ’  ð—£ð—¥ð—˜ð— ð—œð—¨ð—  ð—¨ð—£ð——ð—”ð—§ð—˜ ðŸ’ 
â•°â”€â”€â”€â”€â”€ â”â”â”â”â”â” â”€â”€â”€â”€â”€â•¯

 ðŸ•’ ð—§ð—¶ð—ºð—²    : ${time}
 ðŸ“… ð——ð—®ð˜ð—²    : ${date}
 ðŸ“ ð—Ÿð—¼ð—°ð—®ð˜ð—¶ð—¼ð—»: Kurigram, Rangpur
 â˜ï¸ ð—ªð—²ð—®ð˜ð—µð—²ð—¿  : ${weatherInfo}

 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ðŸ“œ ã€Œ ${quote} ã€
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

 ðŸ’  ð—¦ð˜ð—®ð˜ð˜‚ð˜€: Active Now
 ðŸ”ï¸ ð‚ ð¡ ðš ð§ ð ðž ð«  ð ðš ð¡ ðš ð«
`;

      if (!global.data?.allThreadID) return;
      global.data.allThreadID.forEach(threadID => {
        api.sendMessage(msg, threadID);
      });

    } catch (err) { console.error(err); }
  });
};

module.exports.run = () => {};
        
